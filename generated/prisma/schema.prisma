generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String         @id @default(cuid())
  username          String         @unique
  email             String         @unique
  password          String
  role              UserRole
  name              String
  phone             String?
  profile_image_url String?
  teacher_id        String?
  school            String?
  school_id         String?
  province_name     String?
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  khmer_font        String?        @default("Suwannaphum")
  theme_preference  String?        @default("light")
  notifications     Notification[]

  @@map("users")
}

model Beneficiary {
  teacher_id               String                  @id
  name                     String
  name_english             String?
  phone                    String?
  sex                      Sex?
  role                     String?
  passcode                 String?
  province_name            String?
  district_name            String?
  commune_name             String?
  village_name             String?
  school                   String?
  school_id                String?
  position                 String?
  subject                  String?
  grade                    Int?
  profile_image_url        String?
  signature_url            String?
  status                   BeneficiaryStatus
  is_deleted               Boolean                 @default(false)
  profile_completed        Boolean                 @default(false)
  created_at               DateTime                @default(now())
  updated_at               DateTime                @updatedAt
  created_by               String?
  updated_by               String?
  attendance_records       AttendanceRecord[]
  trainings                BeneficiaryTraining[]
  event_attendance_records EventAttendanceRecord[]
  event_registrations      EventRegistration[]
  survey_responses         SurveyResponse[]
  telegram_user            TelegramUser?

  @@map("beneficiaries")
}

model Training {
  id                           String                 @id @default(cuid())
  training_code                String                 @unique
  training_name                String
  training_name_english        String?
  training_description         String?
  training_type                TrainingType?
  training_category            String?
  training_level               TrainingLevel?
  training_status              TrainingStatus
  training_start_date          DateTime
  training_end_date            DateTime
  registration_deadline        DateTime?
  training_location            String
  training_venue               String?
  venue_latitude               Float?
  venue_longitude              Float?
  geofence_radius              Int                    @default(100)
  province_name                String?
  district_name                String?
  commune_name                 String?
  school_name                  String?
  cluster_schools              String[]
  max_participants             Int
  current_participants         Int                    @default(0)
  qr_code_data                 String?
  gps_validation_required      Boolean                @default(false)
  geofence_validation_required Boolean                @default(false)
  is_published                 Boolean                @default(false)
  training_is_deleted          Boolean                @default(false)
  training_created_by          String?
  training_updated_by          String?
  training_created_at          DateTime               @default(now())
  training_updated_at          DateTime               @updatedAt
  attendance_records           AttendanceRecord[]
  beneficiary_trainings        BeneficiaryTraining[]
  survey_responses             SurveyResponse[]
  agendas                      TrainingAgenda[]
  material_links               TrainingMaterialLink[]
  survey_links                 TrainingSurveyLink[]

  @@map("trainings")
}

model Event {
  id                           String                  @id @default(cuid())
  event_code                   String                  @unique
  event_name                   String
  event_name_english           String?
  event_description            String?
  event_type                   EventType
  event_category               String?
  event_format                 EventFormat             @default(IN_PERSON)
  event_status                 EventStatus
  event_start_date             DateTime
  event_end_date               DateTime
  registration_deadline        DateTime?
  registration_start           DateTime?
  event_location               String?
  event_venue                  String?
  venue_latitude               Float?
  venue_longitude              Float?
  geofence_radius              Int                     @default(100)
  province_name                String?
  district_name                String?
  virtual_platform             String?
  virtual_meeting_url          String?
  virtual_meeting_id           String?
  virtual_passcode             String?
  max_attendees                Int
  current_attendees            Int                     @default(0)
  allow_public_registration    Boolean                 @default(true)
  requires_approval            Boolean                 @default(false)
  is_multi_track               Boolean                 @default(false)
  qr_code_data                 String?
  gps_validation_required      Boolean                 @default(false)
  geofence_validation_required Boolean                 @default(false)
  is_published                 Boolean                 @default(false)
  banner_image_url             String?
  tags                         String[]                @default([])
  is_deleted                   Boolean                 @default(false)
  created_by                   String?
  updated_by                   String?
  created_at                   DateTime                @default(now())
  updated_at                   DateTime                @updatedAt
  attendance_records           EventAttendanceRecord[]
  material_links               EventMaterialLink[]
  registrations                EventRegistration[]
  sessions                     EventSession[]
  speakers                     EventSpeaker[]

  @@map("events")
}

model EventSession {
  id                    String                     @id @default(cuid())
  event_id              String
  session_code          String                     @unique
  session_name          String
  session_name_english  String?
  session_description   String?
  session_date          DateTime
  session_start_time    DateTime
  session_end_time      DateTime
  session_location      String?
  session_room          String?
  venue_latitude        Float?
  venue_longitude       Float?
  virtual_meeting_url   String?
  track_name            String?
  track_color           String?
  max_attendees         Int
  current_attendees     Int                        @default(0)
  session_type          SessionType                @default(PRESENTATION)
  is_cancelled          Boolean                    @default(false)
  is_deleted            Boolean                    @default(false)
  sort_order            Int                        @default(0)
  created_at            DateTime                   @default(now())
  updated_at            DateTime                   @updatedAt
  created_by            String?
  updated_by            String?
  session_registrations EventSessionRegistration[]
  speakers              EventSessionSpeaker[]
  event                 Event                      @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@index([event_id])
  @@map("event_sessions")
}

model EventRegistration {
  id                    String                     @id @default(cuid())
  event_id              String
  registration_code     String                     @unique
  beneficiary_id        String?
  attendee_name         String?
  attendee_name_english String?
  attendee_email        String?
  attendee_phone        String?
  attendee_organization String?
  attendee_position     String?
  attendee_province     String?
  attendee_district     String?
  registration_date     DateTime
  registration_method   RegistrationMethod
  registration_source   String?
  registration_status   RegistrationStatus
  approval_status       ApprovalStatus             @default(PENDING)
  approved_by           String?
  approved_at           DateTime?
  check_in_time         DateTime?
  check_out_time        DateTime?
  attendance_status     String?
  attendee_role         AttendeeRole               @default(PARTICIPANT)
  dietary_requirements  String?
  accessibility_needs   String?
  special_requests      String?
  qr_code_data          String?
  is_deleted            Boolean                    @default(false)
  created_at            DateTime                   @default(now())
  updated_at            DateTime                   @updatedAt
  beneficiary           Beneficiary?               @relation(fields: [beneficiary_id], references: [teacher_id])
  event                 Event                      @relation(fields: [event_id], references: [id], onDelete: Cascade)
  session_registrations EventSessionRegistration[]

  @@index([event_id])
  @@index([beneficiary_id])
  @@map("event_registrations")
}

model EventSessionRegistration {
  id              String            @id @default(cuid())
  registration_id String
  session_id      String
  registered_at   DateTime          @default(now())
  checked_in      Boolean           @default(false)
  check_in_time   DateTime?
  registration    EventRegistration @relation(fields: [registration_id], references: [id], onDelete: Cascade)
  session         EventSession      @relation(fields: [session_id], references: [id], onDelete: Cascade)

  @@unique([registration_id, session_id])
  @@index([registration_id])
  @@index([session_id])
  @@map("event_session_registrations")
}

model EventAttendanceRecord {
  id                    String                  @id @default(cuid())
  event_id              String
  beneficiary_id        String?
  registration_id       String?
  date                  DateTime                @db.Date
  morning_in            DateTime?
  morning_out           DateTime?
  afternoon_in          DateTime?
  afternoon_out         DateTime?
  attendance_status     SessionAttendanceStatus
  manual_entry          Boolean                 @default(false)
  manual_marked_by      String?
  manual_marked_by_name String?
  manual_entry_reason   String?
  location_lat          Float?
  location_lng          Float?
  location_accuracy     Float?
  device                String?
  created_at            DateTime                @default(now())
  updated_at            DateTime                @updatedAt
  beneficiary           Beneficiary?            @relation(fields: [beneficiary_id], references: [teacher_id])
  event                 Event                   @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@unique([event_id, beneficiary_id, date])
  @@index([event_id])
  @@index([beneficiary_id])
  @@map("event_attendance_records")
}

model EventSpeaker {
  id                   String                @id @default(cuid())
  event_id             String
  speaker_name         String
  speaker_name_english String?
  speaker_title        String?
  speaker_position     String?
  speaker_organization String?
  speaker_bio          String?
  speaker_photo_url    String?
  speaker_email        String?
  speaker_phone        String?
  linkedin_url         String?
  twitter_url          String?
  website_url          String?
  speaker_type         SpeakerType           @default(SPEAKER)
  is_keynote_speaker   Boolean               @default(false)
  is_featured          Boolean               @default(false)
  sort_order           Int                   @default(0)
  is_deleted           Boolean               @default(false)
  created_at           DateTime              @default(now())
  updated_at           DateTime              @updatedAt
  sessions             EventSessionSpeaker[]
  event                Event                 @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@index([event_id])
  @@map("event_speakers")
}

model EventSessionSpeaker {
  id         String       @id @default(cuid())
  session_id String
  speaker_id String
  role       String?
  created_at DateTime     @default(now())
  session    EventSession @relation(fields: [session_id], references: [id], onDelete: Cascade)
  speaker    EventSpeaker @relation(fields: [speaker_id], references: [id], onDelete: Cascade)

  @@unique([session_id, speaker_id])
  @@index([session_id])
  @@index([speaker_id])
  @@map("event_session_speakers")
}

model EventMaterialLink {
  id          String           @id @default(cuid())
  event_id    String
  material_id String
  sort_order  Int              @default(0)
  is_required Boolean          @default(false)
  linked_at   DateTime         @default(now())
  linked_by   String?
  event       Event            @relation(fields: [event_id], references: [id], onDelete: Cascade)
  material    TrainingMaterial @relation(fields: [material_id], references: [id], onDelete: Cascade)

  @@unique([event_id, material_id])
  @@index([event_id])
  @@index([material_id])
  @@map("event_material_links")
}

model BeneficiaryTraining {
  beneficiary_training_id         String              @id @default(cuid())
  beneficiary_id                  String
  training_id                     String
  registration_date               DateTime
  registration_method             RegistrationMethod?
  attendance_status               AttendanceStatus
  attendance_percentage           Float?
  training_role                   TrainingRole
  enrollment_type                 String
  certificate_issued              Boolean             @default(false)
  certificate_number              String?
  certificate_issue_date          DateTime?
  feedback_submitted              Boolean             @default(false)
  feedback_score                  Float?
  feedback_comments               String?
  beneficiary_training_status     String
  beneficiary_training_created_at DateTime            @default(now())
  beneficiary_training_updated_at DateTime            @updatedAt
  beneficiary                     Beneficiary         @relation(fields: [beneficiary_id], references: [teacher_id])
  training                        Training            @relation(fields: [training_id], references: [id])

  @@unique([beneficiary_id, training_id])
  @@map("beneficiary_trainings")
}

model AttendanceRecord {
  id                        String                  @id @default(cuid())
  training_id               String
  beneficiary_id            String
  date                      DateTime                @db.Date
  morning_in                DateTime?
  morning_out               DateTime?
  afternoon_in              DateTime?
  afternoon_out             DateTime?
  session_attendance_status SessionAttendanceStatus
  manual_entry              Boolean                 @default(false)
  manual_marked_by          String?
  manual_marked_by_name     String?
  manual_entry_reason       String?
  location_lat              Float?
  location_lng              Float?
  location_accuracy         Float?
  device                    String?
  created_at                DateTime                @default(now())
  updated_at                DateTime                @updatedAt
  beneficiary               Beneficiary             @relation(fields: [beneficiary_id], references: [teacher_id])
  training                  Training                @relation(fields: [training_id], references: [id])

  @@unique([training_id, beneficiary_id, date])
  @@map("attendance_records")
}

model SystemSettings {
  id          String      @id @default(cuid())
  key         String      @unique
  value       String
  type        SettingType
  category    String?
  label       String?
  description String?
  options     String[]    @default([])
  is_public   Boolean     @default(false)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt
  updated_by  String?

  @@map("system_settings")
}

model TrainingCategory {
  id          String   @id @default(cuid())
  code        String   @unique
  name_en     String
  name_km     String
  description String?
  icon        String?
  color       String?
  is_active   Boolean  @default(true)
  sort_order  Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  created_by  String?
  updated_by  String?

  @@map("training_categories")
}

model TrainingTypeConfig {
  id          String   @id @default(cuid())
  code        String   @unique
  name_en     String
  name_km     String
  description String?
  icon        String?
  color       String?
  is_active   Boolean  @default(true)
  sort_order  Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  created_by  String?
  updated_by  String?

  @@map("training_types")
}

model TrainingLevelConfig {
  id             String   @id @default(cuid())
  code           String   @unique
  name_en        String
  name_km        String
  description_en String?
  description_km String?
  icon           String?
  color          String?
  is_active      Boolean  @default(true)
  sort_order     Int      @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  created_by     String?
  updated_by     String?

  @@map("training_levels")
}

model BeneficiaryPosition {
  id          String   @id @default(cuid())
  code        String   @unique
  name_en     String
  name_km     String
  description String?
  is_active   Boolean  @default(true)
  sort_order  Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  created_by  String?
  updated_by  String?

  @@map("beneficiary_positions")
}

model BeneficiaryDepartment {
  id          String   @id @default(cuid())
  code        String   @unique
  name_en     String
  name_km     String
  description String?
  is_active   Boolean  @default(true)
  sort_order  Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  created_by  String?
  updated_by  String?

  @@map("beneficiary_departments")
}

model TrainingAgenda {
  id                 String   @id @default(cuid())
  training_id        String
  day_number         Int
  start_time         String
  end_time           String
  topic_en           String
  topic_km           String
  description_en     String?
  description_km     String?
  instructor_name    String?
  instructor_name_km String?
  sort_order         Int      @default(0)
  is_deleted         Boolean  @default(false)
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt
  created_by         String?
  updated_by         String?
  training           Training @relation(fields: [training_id], references: [id], onDelete: Cascade)

  @@index([training_id])
  @@map("training_agendas")
}

model TrainingMaterial {
  id             String                 @id @default(cuid())
  title_en       String
  title_km       String
  description_en String?
  description_km String?
  material_type  String
  file_url       String?
  external_url   String?
  file_name      String?
  file_size      Int?
  mime_type      String?
  category       String?
  is_active      Boolean                @default(true)
  is_deleted     Boolean                @default(false)
  created_at     DateTime               @default(now())
  updated_at     DateTime               @updatedAt
  created_by     String?
  updated_by     String?
  event_links    EventMaterialLink[]
  training_links TrainingMaterialLink[]

  @@map("training_materials")
}

model TrainingMaterialLink {
  id          String           @id @default(cuid())
  training_id String
  material_id String
  sort_order  Int              @default(0)
  is_required Boolean          @default(false)
  linked_at   DateTime         @default(now())
  linked_by   String?
  material    TrainingMaterial @relation(fields: [material_id], references: [id], onDelete: Cascade)
  training    Training         @relation(fields: [training_id], references: [id], onDelete: Cascade)

  @@unique([training_id, material_id])
  @@index([training_id])
  @@index([material_id])
  @@map("training_material_links")
}

model Survey {
  id                          String               @id @default(cuid())
  title_en                    String
  title_km                    String
  description_en              String?
  description_km              String?
  survey_type                 SurveyType
  is_template                 Boolean              @default(false)
  is_required                 Boolean              @default(false)
  passing_score               Int?
  time_limit                  Int?
  allow_retake                Boolean              @default(false)
  max_attempts                Int?
  show_results_to_beneficiary Boolean              @default(true)
  show_correct_answers        Boolean              @default(false)
  available_from              DateTime?
  available_until             DateTime?
  is_active                   Boolean              @default(true)
  created_at                  DateTime             @default(now())
  updated_at                  DateTime             @updatedAt
  created_by                  String?
  updated_by                  String?
  questions                   SurveyQuestion[]
  responses                   SurveyResponse[]
  training_links              TrainingSurveyLink[]

  @@map("surveys")
}

model TrainingSurveyLink {
  id              String       @id @default(cuid())
  training_id     String
  survey_id       String
  timing          SurveyTiming
  is_required     Boolean      @default(false)
  sort_order      Int          @default(0)
  custom_deadline DateTime?
  linked_at       DateTime     @default(now())
  linked_by       String?
  survey          Survey       @relation(fields: [survey_id], references: [id], onDelete: Cascade)
  training        Training     @relation(fields: [training_id], references: [id], onDelete: Cascade)

  @@unique([training_id, survey_id])
  @@index([training_id])
  @@index([survey_id])
  @@map("training_survey_links")
}

model SurveyQuestion {
  id               String                   @id @default(cuid())
  survey_id        String
  question_text_en String
  question_text_km String
  help_text_en     String?
  help_text_km     String?
  question_type    QuestionType
  is_required      Boolean                  @default(true)
  sort_order       Int                      @default(0)
  points           Int?
  correct_answer   String?
  options_en       String[]
  options_km       String[]
  scale_min        Int?
  scale_max        Int?
  scale_labels_en  String[]
  scale_labels_km  String[]
  created_at       DateTime                 @default(now())
  updated_at       DateTime                 @updatedAt
  answers          SurveyQuestionResponse[]
  survey           Survey                   @relation(fields: [survey_id], references: [id], onDelete: Cascade)

  @@index([survey_id])
  @@map("survey_questions")
}

model SurveyResponse {
  id                 String                   @id @default(cuid())
  survey_id          String
  beneficiary_id     String
  training_id        String
  started_at         DateTime?
  submitted_at       DateTime?
  is_complete        Boolean                  @default(false)
  attempt_number     Int                      @default(1)
  total_score        Float?
  max_score          Float?
  percentage         Float?
  passed             Boolean?
  time_spent_seconds Int?
  created_at         DateTime                 @default(now())
  updated_at         DateTime                 @updatedAt
  question_responses SurveyQuestionResponse[]
  beneficiary        Beneficiary              @relation(fields: [beneficiary_id], references: [teacher_id])
  survey             Survey                   @relation(fields: [survey_id], references: [id], onDelete: Cascade)
  training           Training                 @relation(fields: [training_id], references: [id])

  @@unique([survey_id, beneficiary_id, training_id, attempt_number])
  @@index([survey_id])
  @@index([beneficiary_id])
  @@index([training_id])
  @@map("survey_responses")
}

model SurveyQuestionResponse {
  id            String         @id @default(cuid())
  response_id   String
  question_id   String
  answer_value  String
  answer_text   String?
  points_earned Float?
  is_correct    Boolean?
  answered_at   DateTime       @default(now())
  question      SurveyQuestion @relation(fields: [question_id], references: [id], onDelete: Cascade)
  response      SurveyResponse @relation(fields: [response_id], references: [id], onDelete: Cascade)

  @@unique([response_id, question_id])
  @@index([response_id])
  @@index([question_id])
  @@map("survey_question_responses")
}

model TelegramUser {
  id            String      @id @default(uuid())
  telegram_id   BigInt      @unique
  teacher_id    String      @unique
  username      String?
  first_name    String?
  last_name     String?
  language_code String?
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt
  beneficiary   Beneficiary @relation(fields: [teacher_id], references: [teacher_id], onDelete: Cascade)

  @@index([telegram_id])
  @@index([teacher_id])
  @@map("telegram_users")
}

model Notification {
  id                  String               @id @default(cuid())
  user_id             String
  title               String
  message             String
  type                NotificationType     @default(INFO)
  priority            NotificationPriority @default(NORMAL)
  related_entity_type String?
  related_entity_id   String?
  action_url          String?
  is_read             Boolean              @default(false)
  read_at             DateTime?
  is_deleted          Boolean              @default(false)
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt
  user                User                 @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([user_id, is_read])
  @@index([created_at])
  @@map("notifications")
}

enum UserRole {
  ADMIN
  SUPER_ADMIN
  BENEFICIARY
}

enum Sex {
  M
  F
}

enum BeneficiaryStatus {
  ACTIVE
  INACTIVE
}

enum TrainingType {
  WORKSHOP
  COURSE
  SEMINAR
}

enum TrainingLevel {
  NATIONAL
  PROVINCIAL
  CLUSTER
}

enum TrainingStatus {
  DRAFT
  ONGOING
  COMPLETED
  CANCELLED
}

enum EventType {
  CONFERENCE
  WORKSHOP
  SEMINAR
  WEBINAR
  MEETING
  CEREMONY
  TRAINING
  NETWORKING
  EXHIBITION
  OTHER
}

enum EventFormat {
  IN_PERSON
  VIRTUAL
  HYBRID
}

enum EventStatus {
  DRAFT
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

enum SessionType {
  PRESENTATION
  WORKSHOP
  PANEL_DISCUSSION
  KEYNOTE
  BREAKOUT_SESSION
  Q_AND_A
  NETWORKING
  BREAK
  MEAL
}

enum RegistrationStatus {
  REGISTERED
  CONFIRMED
  CANCELLED
  WAITLISTED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AttendeeRole {
  PARTICIPANT
  SPEAKER
  PANELIST
  MODERATOR
  ORGANIZER
  VOLUNTEER
  VIP
  SPONSOR
  MEDIA
}

enum SpeakerType {
  SPEAKER
  PANELIST
  MODERATOR
  FACILITATOR
  TRAINER
}

enum RegistrationMethod {
  QR
  MANUAL
  IMPORT
}

enum AttendanceStatus {
  REGISTERED
  ATTENDED
  COMPLETED
  DROPPED
}

enum TrainingRole {
  PARTICIPANT
  TRAINER
  COORDINATOR
}

enum SessionAttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum SettingType {
  STRING
  NUMBER
  BOOLEAN
  JSON
  SELECT
}

enum SurveyType {
  PRE_TEST
  POST_TEST
  FEEDBACK
  EVALUATION
  COMMON_TEST
}

enum SurveyTiming {
  BEFORE_TRAINING
  DURING_TRAINING
  AFTER_TRAINING
}

enum QuestionType {
  MULTIPLE_CHOICE
  MULTIPLE_SELECT
  TRUE_FALSE
  LIKERT_SCALE
  RATING
  SHORT_TEXT
  LONG_TEXT
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  TRAINING
  EVENT
  SURVEY
  ATTENDANCE
  CERTIFICATE
  SYSTEM
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}
